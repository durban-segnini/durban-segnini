# when using the default proxy server port
local_backend: true

# Use DecapBridge auth (required)
backend:
  name: git-gateway
  repo: adeluccar/durban-segnini
  branch: main
  identity_url: https://auth.decapbridge.com/sites/6c2dad04-8348-46c2-bd12-62bb5d5dfb72
  gateway_url: https://gateway.decapbridge.com

  # Quickly see who did what (optional)
  commit_messages:
    create: Create {{collection}} “{{slug}}” - {{author-name}} <{{author-login}}> via DecapBridge
    update: Update {{collection}} “{{slug}}” - {{author-name}} <{{author-login}}> via DecapBridge
    delete: Delete {{collection}} “{{slug}}” - {{author-name}} <{{author-login}}> via DecapBridge
    uploadMedia: Upload “{{path}}” - {{author-name}} <{{author-login}}> via DecapBridge
    deleteMedia: Delete “{{path}}” - {{author-name}} <{{author-login}}> via DecapBridge
    openAuthoring: Message {{message}} - {{author-name}} <{{author-login}}> via DecapBridge

# Better Decap + Bridge logo (optional)
logo_url: https://decapbridge.com/decapcms-with-bridge.svg

# Add site links in DecapCMS (optional)
site_url: https://durbansegnini.com
media_folder: "src/assets/uploads"
public_folder: "/uploads"

# Activate Editorial Workflow
publish_mode: editorial_workflow

# Disable preview pane for all collections
editor:
  preview: false

# Cloudinary media library configuration
media_library:
  name: cloudinary
  config:
    cloud_name: dao1vqck0
    api_key: 592251927921395
    upload_preset: unsigned_upload
    # Removed global default_transformations to prevent PDF files from getting image transformations
    # Transformations will be applied only to specific image widgets
  output_filename_only: false
  use_transformations: true
  use_secure_url: true

collections:
  - name: artists
    label: Artists
    label_singular: Artist
    folder: "src/content/artists"
    create: true
    format: frontmatter
    extension: md
    slug: "{{first_name | slugify }}-{{ last_name | slugify }}"
    identifier_field: name
    fields:
      - { name: first_name, label: First Name, widget: string }
      - { name: last_name,  label: Last Name,  widget: string }
      - { name: name,       label: Display Name, widget: hidden, required: false }
      - { name: computed_slug, label: Computed Slug, widget: hidden, required: false }
      - { name: year_of_birth, label: Year of Birth, widget: string, required: false }
      - { name: year_of_death, label: Year of Death, widget: string, required: false }
      - name: portrait
        label: Portrait
        widget: image
        required: false
        media_library:
          name: cloudinary
          config:
            folder: "site/artists"
            transformations:
              - - fetch_format: auto
                  width: 1024
                  height: 1024
                  quality: auto
                  crop: limit
                  flags: progressive
      - { name: short_bio, label: Short Bio, widget: markdown, required: false }
      - { name: body, label: Bio, widget: markdown, required: false }

  - name: works
    label: Works
    label_singular: Work
    folder: "src/content/works"
    create: true
    format: frontmatter
    extension: md

    # file like "guernica.md" based on Title
    slug: "{{ artist | slugify }}-{{ year }}-{{ work_id }}"
    identifier_field: work_id
    summary: "{{ artist }} — {{ fields.year }} — {{title}} (ID: {{work_id}})"

    fields:
      # ——— Basics
      - { name: work_id, label: Work ID, widget: hidden, required: false }
      - { name: title, label: Title, widget: string }

      # Single artist (one-to-one)
      - name: artist
        label: Artist
        widget: relation
        collection: artists
        multiple: false
        search_fields: [name, first_name, last_name]
        value_field: name
        display_fields: [name]

      # ——— Work details
      # Keep 'year' as a string so you can do things like "c. 1972" or "1972–74"
      - { name: year, label: Year (creation), widget: string, required: true }
      - { name: medium, label: Medium, widget: string, required: false }
      - { name: dimensions, label: Dimensions, widget: string, required: false }

      # ——— Image (required)
      - name: image
        label: Image
        widget: image
        required: true
        media_library:
          name: cloudinary
          config:
            folder: "site/works"
            transformations:
              - - fetch_format: auto
                  width: 1024
                  height: 1024
                  quality: auto
                  crop: limit
                  flags: progressive

      # ——— Full description in the Markdown BODY (not just front matter)
      - { name: body, label: Description, widget: markdown, required: false }

      # Optional: lock the default 11ty template for a work page
      # - { name: layout, widget: hidden, default: "work.njk" }


  - name: exhibitions
    label: Exhibitions
    label_singular: Exhibition
    folder: "src/content/exhibitions"
    create: true
    format: frontmatter
    extension: md

    # file like "autumn-show-2025.md"
    slug: "{{ title | slugify }}"
    identifier_field: title
    summary: "{{ title }}"

    fields:
      # ——— Basics
      - { name: title, label: Title, widget: string }

      # Status (manual), plus optional archive flag
      - { name: status, label: Status, widget: select, options: [upcoming, current, past], required: true }
      
      # Featured flag for homepage display
      - { name: featured, label: Featured on Homepage, widget: boolean, default: false, required: false, hint: "Enable to display this exhibition on the homepage hero section" }
      
      # Structured date fields for filtering and display
      - name: startingDate
        label: Starting Date
        widget: datetime
        format: "YYYY-MM-DD"
        time_format: false
        picker_utc: true
        required: true
        hint: "Opening date of the exhibition"
      
      - name: endingDate
        label: Ending Date
        widget: datetime
        format: "YYYY-MM-DD"
        time_format: false
        picker_utc: true
        required: true
        hint: "Closing date of the exhibition"

      # ——— Media
      - name: poster
        label: Poster
        widget: image
        required: false
        media_library:
          name: cloudinary
          config:
            folder: "site/exhibitions/posters"
            transformations:
              - - fetch_format: auto
                  width: 1024
                  height: 1024
                  quality: auto
                  crop: limit
                  flags: progressive

      - name: press_release_pdf
        label: Press Release (PDF)
        widget: file
        required: false
        media_library:
          name: cloudinary
          config:
            folder: "site/exhibitions/press"

      - name: catalog_pdf
        label: Catalog (PDF)
        widget: file
        required: false
        media_library:
          name: cloudinary
          config:
            folder: "site/exhibitions/catalogs"

      - name: photos
        label: Exhibition Photos
        widget: list
        required: false
        allow_add: true
        collapsed: false
        fields:
          - name: image
            label: Photo
            widget: image
            required: true
            media_library:
              name: cloudinary
              config:
                folder: "site/exhibitions/photos"
                transformations:
                  - - fetch_format: auto
                      width: 1024
                      height: 1024
                      quality: auto
                      crop: limit
                      flags: progressive

      # Pick the works in this exhibition (many)
      - name: works
        label: Works
        widget: relation
        required: false
        collection: works
        multiple: true
        search_fields: [work_id, title, artist]
        value_field: work_id      # uses unique work_id instead of title
        display_fields: [work_id, title, artist, year]

      # ——— Page copy (Markdown body)
      - { name: body, label: Notes / Description, widget: markdown, required: false }

      # Optional: lock the template used by 11ty for exhibitions
      # - { name: layout, widget: hidden, default: "exhibition.njk" }


  - name: artfairs
    label: Art Fairs
    label_singular: Art Fair
    folder: "src/content/artfairs"
    create: true
    format: frontmatter
    extension: md

    # filename like "2025-art-basel-miami-beach.md"
    slug: "{{ year }}-{{ title | slugify }}"
    identifier_field: title
    summary: "{{ fields.year }} — {{ title }}"

    fields:
      - { name: title, label: Title, widget: string }
      - { name: year,  label: Year,  widget: number }
      # Artists are typed into the Markdown body—one per line / list—no relations needed.
      - { name: body,  label: List of Artists, widget: markdown }

      # Optional: lock the template
      # - { name: layout, widget: hidden, default: "artfair.njk" }

  - name: news
    label: News
    label_singular: News Item
    folder: "src/content/news"
    create: true
    format: frontmatter
    extension: md

    # ✅ produces: 2025-09-30-the-news-title
    slug: "{{year}}-{{month}}-{{day}}-{{slug}}"
    summary: "{{ date | date('YYYY-MM-DD') }}-{{ title | slugify }}"
    identifier_field: title

    fields:
      - { name: title, label: Title, widget: string }
      - name: date
        label: Date
        widget: datetime
        format: "YYYY-MM-DD"   # store date-only string
        time_format: false     # no time portion
        picker_utc: true       # avoid TZ shifts
      - { name: body, label: Body, widget: markdown }
